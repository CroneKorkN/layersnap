#!/bin/bash

ls_status() {
  if [ -d "$ConfDir" ]; then
    echo "$TargetDir is layersnapped!"
  else
    echo "$TargetDir is not layersnapped."
  fi
}

ls_snapshot() {
  mkdir -p "$ConfDir"
  mv "$TargetDir" "$LowerDir"
  
  mkdir "$UpperDir"
  mkdir "$WorkDir"
  
  mkdir "$TargetDir"
  mount -t overlay overlay -olowerdir="$LowerDir",upperdir="$UpperDir",workdir="$WorkDir" $TargetDir
}

ls_merge() {
  umount "$TargetDir"
  rm -R "$TargetDir"

  rsync -av "$UpperDir/"* "$LowerDir"
  mv "$LowerDir" "$TargetDir"
  
  rm -R "$ConfDir"
}

ls_restore() {
    umount "$TargetDir"
    rm -R "$TargetDir"
    
    rm -R "$WorkDir"
    rm -R "$UpperDir"

    mv "$LowerDir" "$TargetDir"
    rm -R "$ConfDir"
}
